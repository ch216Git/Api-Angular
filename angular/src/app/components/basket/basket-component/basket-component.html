<div *ngIf="(basket$ | async) as basket; else emptyCart" class="basket-container">

  <!-- חבילות -->
  <div *ngIf="packagesWithCount.length">
    <h3 class="section-title">החבילות שלך</h3>

    <div class="basket-list">
      <div *ngFor="let item of packagesWithCount" class="basket-row">

        <div class="item-main">
          <span class="item-name">{{ item.package.name }}</span>
          <span class="item-price">{{ item.package.price }} ₪</span>
        </div>

        <div class="quantity-controls">
          <button class="btn-qty" (click)="removePackage(item.package.id)">−</button>
          <span class="qty-value">{{ item.count }}</span>
          <button class="btn-qty" (click)="addPackage(item.package.id)">+</button>
        </div>

        <div class="item-total">
          {{ item.package.price * item.count }} ₪
        </div>

        <i class="pi pi-trash delete-icon" (click)="removeAllPackage(item.package.id)">
        </i>

      </div>
    </div>
  </div>

  <!-- מתנות -->
  <div *ngIf="giftsWithCount.length">
    <h3 class="section-title">המתנות שלך</h3>

    <div class="basket-list">
      <div *ngFor="let item of giftsWithCount" class="basket-row">

        <img class="item-image" [src]="item.gift.image" alt="{{ item.gift.name }}" />

        <span class="item-name">{{ item.gift.name }}</span>

        <div class="quantity-controls">
          <button (click)="removeGift(item.gift.id)" class="btn-qty">-</button>
          <span class="qty-value">{{ item.count }}</span>
          <button (click)="addGift(item.gift.id)" class="btn-qty">+</button>
        </div>

        <i class="pi pi-trash delete-icon" (click)="removeAllGift(item.gift.id)"></i>
      </div>
    </div>
  </div>

  <!-- סיכום -->
  <div class="basket-footer" *ngIf="packagesWithCount.length || giftsWithCount.length">
    <div class="basket-sum">
      סה"כ לתשלום: <b>{{ basket.sum }} ₪</b>
    </div>
    <button class="checkout-btn" (click)="showDialog()">
      המשך לתשלום
    </button>

  </div>

</div>

<!-- סל ריק -->
<ng-template #emptyCart>
  <div class="empty-cart-wrapper">
    <b>העגלה ריקה</b>
    <p>בחר אחת מהחבילות בעמוד</p>
    <img src="https://localhost:7081/uploads/emptyCart.WEBP" alt="emptyCart" class="emptyCart" />
  </div>
</ng-template>

<!-- דיאלוג תשלום -->
<p-dialog header="פרטי תשלום" [(visible)]="visible" [modal]="true" [style]="{ width: '320px' }">
  <form #cardForm="ngForm" class="payment-form">

    <input pInputText placeholder="מספר כרטיס" name="card" ngModel required minlength="16" />
    <div class="row">
      <input pInputText placeholder="MM/YY" name="exp" ngModel required />
      <input pInputText placeholder="CVV" name="cvv" ngModel required minlength="3" />
    </div>

    <p-button label="אישור" [disabled]="cardForm.invalid" (onClick)="saveProfile()">
    </p-button>

  </form>
</p-dialog>